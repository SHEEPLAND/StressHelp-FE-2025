import"./modulepreload-polyfill-B5Qt9EMX.js";import"./home-BLxqoWyD.js";import{f as P}from"./fetch-CfNAfVVD.js";const D=document.getElementById("entry_date"),A=document.getElementById("month-year"),_=document.getElementById("calendar-dates"),C=document.getElementById("prev-month"),K=document.getElementById("next-month"),S=document.getElementById("history-popup"),L=document.getElementById("history-popup-content"),N=document.getElementById("popup-date"),q=document.getElementById("close-history-popup");let I=[],E=new Date;M();function w(o){const t=new Date(o),n=t.getFullYear(),d=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${n}-${d}-${i}`}async function M(){const o=localStorage.getItem("token");if(!o){alert("Kirjaudu sisään."),window.location.href="login.html";return}const n=await P("http://4.231.239.48/api/entries",{method:"GET",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(n.error){console.error("Virhe haettaessa tietoja!",n.error);return}I=Array.isArray(n)?n:Array.isArray(n.entries)?n.entries:Array.isArray(n.data)?n.data:[],I.sort((d,i)=>new Date(i.entry_date)-new Date(d.entry_date)),h()}function h(){const o=E.getFullYear(),t=E.getMonth(),n=new Date(o,t,1).getDay(),d=new Date(o,t+1,0).getDate(),i=new Date(o,t,0).getDate(),e=new Date,s=(n+6)%7;_.innerHTML="";const y=["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"];A.innerText=`${y[t]} ${o}`;for(let a=s;a>0;a--)_.innerHTML+=`<div style="opacity: 0.4">${i-a+1}</div>`;for(let a=1;a<=d;a++){let c=function(p){const m=I.filter(l=>w(l.entry_date)===p);if(m.length===0)return"";const g=Math.max(...m.map(l=>l.stress_level??0));return m.map(l=>{var v;return(v=l.mood)==null?void 0:v.toLowerCase()}),g>=8?'<div class="dot red"></div>':g>=4?'<div class="dot yellow"></div>':'<div class="dot green"></div>'};const r=`${o}-${String(t+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`,u=a===e.getDate()&&t===e.getMonth()&&o===e.getFullYear(),k=D&&D.value===r;_.innerHTML+=`
            <div class="calendar-date ${u?"today":""} ${k?"selected":""}" data-date="${r}">
                ${a}
                ${c(r)}
            </div>`}const f=document.querySelector(".calendar-date.today");f&&f.scrollIntoView({behavior:"smooth",block:"center"})}_.addEventListener("click",o=>{const t=o.target.closest(".calendar-date");if(!t)return;const n=t.getAttribute("data-date");D&&(D.value=n),document.querySelectorAll(".calendar-date").forEach(e=>e.classList.remove("selected")),t.classList.add("selected");const d=new Date(n).toLocaleDateString("fi-FI");N.textContent=d,L.innerHTML="";const i=I.filter(e=>w(e.entry_date)===n);i.length===0?L.innerHTML="<p>Ei merkintöjä tälle päivälle.</p>":i.forEach(e=>{const s=document.createElement("div");s.className="popup-entry-card",s.innerHTML=`
                <div class="popup-entry">
                    <h4>Mieliala: ${e.mood||"Ei ilmoitettu"}</h4>
                    <p><strong>Energiataso:</strong> ${e.energy_level??"Ei tietoa"}</p>
                    <p><strong>Stressitaso:</strong> ${e.stress_level??"Ei tietoa"}</p>
                    <p><strong>Uni (tunnit):</strong> ${e.sleep_hours??"Ei tietoa"}</p>
                    <p><strong>Muistiinpanot:</strong> ${e.notes||"Ei muistiinpanoja."}</p>
                    <p><strong>Tavoitteet:</strong> ${e.goals||"Ei tavoitteita."}</p>
                    <div class="popup-buttons">
                        <button class="modify-entry" data-id="${e.entry_id}">✏️ Muokkaa</button>
                        <button class="delete-entry" data-id="${e.entry_id}">🗑️ Poista</button>
                    </div>
                </div>
            `,s.querySelector(".delete-entry").addEventListener("click",async a=>{const r=a.currentTarget.dataset.id,u=localStorage.getItem("token");if(!u)return alert("Kirjaudu sisään.");if(!confirm("Poistetaanko merkintä?"))return;(await fetch(`http://4.231.239.48/api/entries/${r}`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}})).ok?(alert("Poistettu."),await M(),h(),t.dispatchEvent(new Event("click"))):alert("Poistaminen epäonnistui.")}),s.querySelector(".modify-entry").addEventListener("click",async()=>{document.getElementById("entry_id").value=e.entry_id,document.getElementById("entry_date").value=w(e.entry_date),document.getElementById("mood").value=e.mood||"",document.getElementById("energy_level").value=e.energy_level??"",document.getElementById("stress_level").value=e.stress_level??"",document.getElementById("sleep_hours").value=e.sleep_hours??"",document.getElementById("notes").value=e.notes||"",document.getElementById("goals").value=e.goals||"",S.style.display="none",window.scrollTo({top:0,behavior:"smooth"}),await M(),h()}),L.appendChild(s)}),S.style.display="block"});q.addEventListener("click",()=>{S.style.display="none"});C.addEventListener("click",()=>{E.setMonth(E.getMonth()-1),h()});K.addEventListener("click",()=>{E.setMonth(E.getMonth()+1),h()});document.addEventListener("DOMContentLoaded",function(){document.getElementById("entry_date");const o=document.querySelector(".diaryForm"),t=document.getElementById("popup"),n=document.querySelector(".diary-popup");document.getElementById("category");const d=document.getElementById("analysis"),i=document.getElementById("close-popup");o.addEventListener("submit",async function(e){e.preventDefault();const s=o.querySelector('input[type="submit"]');s.disabled=!0;const y=document.getElementById("entry_id").value,f=y?"PUT":"POST",a=y?`http://4.231.239.48/api/entries/${y}`:"http://4.231.239.48/api/entries",r=document.getElementById("entry_date").value,u=document.getElementById("mood").value.toLowerCase(),k=document.getElementById("energy_level").value,c=parseInt(document.getElementById("stress_level").value),p=parseInt(document.getElementById("sleep_hours").value),m=document.getElementById("notes").value,g=document.getElementById("goals").value;if(!r||isNaN(c)||isNaN(p)){alert("Täytä kaikki vaaditut kentät."),s.disabled=!1;return}let l="",v="";if(c>=8){l="Korkea stressi";const b=["Kokeile syvähengitystä.","Kuuntele rauhoittavaa musiikkia.","Mene ulos raikkaaseen ilmaan.","Kirjoita ajatuksiasi ylös."];v=`Stressitasosi on korkea. ${b[Math.floor(Math.random()*b.length)]}`}else c>=4?(l="Kohtalainen stressi",v="Stressitasosi on kohtalainen. Pidä taukoja ja huolehdi itsestäsi."):(l="Normaali stressi",v="Hallitset stressiä hyvin!");let B="";p<4?B="Liian vähän unta! Paranna tapojasi.":p<7?B="Unesi voisi olla parempi. Pyri nukkumaan vähintään 7 tuntia.":B="Hienoa! Unesi kesto on terveellistä.";let j="Kiitos, että jaoit mielialasi!";const H={entry_date:r,mood:u,energy_level:k,stress_level:c,sleep_hours:p,notes:m,goals:g},T=localStorage.getItem("token");if(!T){alert("Sinun täytyy olla kirjautuneena."),s.disabled=!1;return}const $=await P(a,{method:f,headers:{Authorization:`Bearer ${T}`,"Content-Type":"application/json"},body:JSON.stringify(H)});if($.error){console.error("Virhe päiväkirjamerkinnän tallentamisessa!",$.error),alert("Päiväkirjamerkintää ei voitu tallentaa."),s.disabled=!1;return}console.log("Päiväkirjamerkintä tallennettu onnistuneesti!"),console.log("API-vastaus:",$),y||I.push({entry_id:$.entry_id,entry_date:r,mood:u,energy_level:k,stress_level:c,sleep_hours:p,notes:m,goals:g}),h(),s.disabled=!1,n.innerHTML=`
        <p><strong>Päivämäärä:</strong> ${new Date(r).toLocaleDateString("fi-FI")}</p>
        <p><strong>Mieliala:</strong> ${u}</p>
        <p><strong>Energia:</strong> ${k}/10</p>
        <p><strong>Stressi:</strong> ${c}/10 (${l})</p>
        <p><strong>Uni:</strong> ${p}h</p>
        ${m?`<p><strong>Muistiinpanot:</strong> ${m}</p>`:""}
        ${g?`<p><strong>Tavoitteet:</strong> ${g}</p>`:""}
      `,d.innerHTML=`
      <h4 class="analysis-title">Mitä tämä tarkoittaa?</h4>
      <div class="analysis-body">
        <p>🧘🏻 <strong>Stressi:</strong> ${v}</p>
        <p>💤 <strong>Uni:</strong> ${B}</p>
        <p>🤔 <strong>Mieliala:</strong> ${j}</p>
        <p class="encouragement">Jatka eteenpäin! Pienet askeleet vievät suuriin muutoksiin 🫶🏻</p>
      </div>
    `,t.style.display="block",await M(),h(),o.reset(),document.getElementById("entry_id").value=""}),i.addEventListener("click",function(){t.style.display="none"})});
