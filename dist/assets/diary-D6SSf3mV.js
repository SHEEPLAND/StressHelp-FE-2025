import"./modulepreload-polyfill-B5Qt9EMX.js";import"./home-B7Iwr7-j.js";import{f as C}from"./fetch-CfNAfVVD.js";const E=document.getElementById("entry_date");document.getElementById("month-year");const D=document.getElementById("calendar-dates"),K=document.getElementById("prev-month"),q=document.getElementById("next-month"),w=document.getElementById("history-popup"),T=document.getElementById("history-popup-content"),z=document.getElementById("popup-date"),U=document.getElementById("close-history-popup"),H=document.getElementById("jump-to-today"),S=document.getElementById("selected-month"),_=document.getElementById("selected-year");let I=[],c=new Date;M();const Y=["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"];function V(){const t=prompt("Valitse kuukausi (1–12):"),e=parseInt(t);!isNaN(e)&&e>=1&&e<=12&&(c.setMonth(e-1),r())}function O(){const t=prompt("Valitse vuosi (esim. 2025):"),e=parseInt(t);isNaN(e)||(c.setFullYear(e),r())}S&&S.addEventListener("click",V);_&&_.addEventListener("click",O);function b(t){const e=new Date(t),o=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${o}-${l}-${i}`}async function M(){const t=localStorage.getItem("token");if(!t){alert("Kirjaudu sisään."),window.location.href="login.html";return}const o=await C("https://stress-help.northeurope.cloudapp.azure.com/api/entries",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(o.error){console.error("Virhe haettaessa tietoja!",o.error);return}I=Array.isArray(o)?o:Array.isArray(o.entries)?o.entries:Array.isArray(o.data)?o.data:[],I.sort((l,i)=>new Date(i.entry_date)-new Date(l.entry_date)),r()}function r(){const t=c.getFullYear(),e=c.getMonth(),o=new Date(t,e,1).getDay(),l=new Date(t,e+1,0).getDate(),i=new Date(t,e,0).getDate(),n=new Date,s=(o+6)%7;D.innerHTML="",S&&(S.textContent=Y[e]),_&&(_.textContent=t);for(let a=s;a>0;a--)D.innerHTML+=`<div class="calendar-date" style="opacity: 0.4">${i-a+1}</div>`;for(let a=1;a<=l;a++){let k=function(y){const v=I.filter(g=>b(g.entry_date)===y);if(v.length===0)return"";const h=Math.max(...v.map(g=>g.stress_level??0));return h>=8?'<div class="dot red"></div>':h>=4?'<div class="dot yellow"></div>':'<div class="dot green"></div>'};const u=`${t}-${String(e+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`,m=a===n.getDate()&&e===n.getMonth()&&t===n.getFullYear(),f=E&&E.value===u;let p=m?'<div id="live-time" style="font-size: 0.6rem; font-weight: bold; margin-top: 4px;"></div>':"";D.innerHTML+=`
      <div class="calendar-date ${m?"today":""} ${f?"selected":""}" data-date="${u}">
        <div class="date-number">${a}</div>
        ${k(u)}
        ${p}
      </div>`}const d=document.querySelector(".calendar-date.today");d&&d.scrollIntoView({behavior:"smooth",block:"center"})}D.addEventListener("click",t=>{const e=t.target.closest(".calendar-date");if(!e)return;const o=e.getAttribute("data-date");E&&(E.value=o),document.querySelectorAll(".calendar-date").forEach(n=>n.classList.remove("selected")),e.classList.add("selected");const l=new Date(o).toLocaleDateString("fi-FI");z.textContent=l,T.innerHTML="";const i=I.filter(n=>b(n.entry_date)===o);i.length===0?T.innerHTML="<p>Ei merkintöjä tälle päivälle.</p>":i.forEach(n=>{const s=document.createElement("div");s.className="popup-entry-card",s.innerHTML=`
        <div class="popup-entry">
          <h4>Mieliala: ${n.mood||"Ei ilmoitettu"}</h4>
          <p><strong>Energiataso:</strong> ${n.energy_level??"Ei tietoa"}</p>
          <p><strong>Stressitaso:</strong> ${n.stress_level??"Ei tietoa"}</p>
          <p><strong>Uni (tunnit):</strong> ${n.sleep_hours??"Ei tietoa"}</p>
          <p><strong>Muistiinpanot:</strong> ${n.notes||"Ei muistiinpanoja."}</p>
          <p><strong>Tavoitteet:</strong> ${n.goals||"Ei tavoitteita."}</p>
          <div class="popup-buttons">
            <button class="modify-entry" data-id="${n.entry_id}">✏️ Muokkaa</button>
            <button class="delete-entry" data-id="${n.entry_id}">🗑️ Poista</button>
          </div>
        </div>`,s.querySelector(".delete-entry").addEventListener("click",async d=>{const a=d.currentTarget.dataset.id,u=localStorage.getItem("token");if(!u)return alert("Kirjaudu sisään.");if(!confirm("Poistetaanko merkintä?"))return;(await fetch(`https://stress-help.northeurope.cloudapp.azure.com/api/entries/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}})).ok?(alert("Poistettu."),await M(),r(),e.dispatchEvent(new Event("click"))):alert("Poistaminen epäonnistui.")}),s.querySelector(".modify-entry").addEventListener("click",async()=>{document.getElementById("entry_id").value=n.entry_id,document.getElementById("entry_date").value=b(n.entry_date),document.getElementById("mood").value=n.mood||"",document.getElementById("energy_level").value=n.energy_level??"",document.getElementById("stress_level").value=n.stress_level??"",document.getElementById("sleep_hours").value=n.sleep_hours??"",document.getElementById("notes").value=n.notes||"",document.getElementById("goals").value=n.goals||"",w.style.display="none",window.scrollTo({top:0,behavior:"smooth"}),await M(),r()}),T.appendChild(s)}),w.style.display="block"});U.addEventListener("click",()=>{w.style.display="none"});K.addEventListener("click",()=>{c.setMonth(c.getMonth()-1),r()});q.addEventListener("click",()=>{c.setMonth(c.getMonth()+1),r()});function A(){const t=document.getElementById("calendar-clock");if(t){const e=new Date;t.textContent=e.toLocaleTimeString("fi-FI",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}}function N(){const t=document.getElementById("today-clock"),e=document.getElementById("today-date");if(t&&e){const o=new Date;t.textContent=o.toLocaleTimeString("fi-FI",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),e.textContent=o.toLocaleDateString("fi-FI",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}}setInterval(()=>{A(),N()},1e3);A();N();H&&H.addEventListener("click",()=>{c=new Date,E&&(E.value=""),document.querySelectorAll(".calendar-date.selected").forEach(t=>{t.classList.remove("selected")}),r()});document.addEventListener("DOMContentLoaded",function(){document.getElementById("entry_date");const t=document.querySelector(".diaryForm"),e=document.getElementById("popup"),o=document.querySelector(".diary-popup");document.getElementById("category");const l=document.getElementById("analysis"),i=document.getElementById("close-popup");t.addEventListener("submit",async function(n){n.preventDefault();const s=t.querySelector('input[type="submit"]');s.disabled=!0;const d=document.getElementById("entry_id").value,a=d?"PUT":"POST",u=d?`https://stress-help.northeurope.cloudapp.azure.com/api/entries/${d}`:"https://stress-help.northeurope.cloudapp.azure.com/api/entries",m=document.getElementById("entry_date").value,f=document.getElementById("mood").value.toLowerCase(),k=document.getElementById("energy_level").value,p=parseInt(document.getElementById("stress_level").value),y=parseInt(document.getElementById("sleep_hours").value),v=document.getElementById("notes").value,h=document.getElementById("goals").value;if(!m||isNaN(p)||isNaN(y)){alert("Täytä kaikki vaaditut kentät."),s.disabled=!1;return}let g="",B="";if(p>=8){g="Korkea stressi";const P=["Kokeile syvähengitystä.","Kuuntele rauhoittavaa musiikkia.","Mene ulos raikkaaseen ilmaan.","Kirjoita ajatuksiasi ylös."];B=`Stressitasosi on korkea. ${P[Math.floor(Math.random()*P.length)]}`}else p>=4?(g="Kohtalainen stressi",B="Stressitasosi on kohtalainen. Pidä taukoja ja huolehdi itsestäsi."):(g="Normaali stressi",B="Hallitset stressiä hyvin!");let $="";y<4?$="Liian vähän unta! Paranna tapojasi.":y<7?$="Unesi voisi olla parempi. Pyri nukkumaan vähintään 7 tuntia.":$="Hienoa! Unesi kesto on terveellistä.";let x="Kiitos, että jaoit mielialasi!";const F={entry_date:m,mood:f,energy_level:k,stress_level:p,sleep_hours:y,notes:v,goals:h},j=localStorage.getItem("token");if(!j){alert("Sinun täytyy olla kirjautuneena."),s.disabled=!1;return}const L=await C(u,{method:a,headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"},body:JSON.stringify(F)});if(L.error){console.error("Virhe päiväkirjamerkinnän tallentamisessa!",L.error),alert("Päiväkirjamerkintää ei voitu tallentaa."),s.disabled=!1;return}console.log("Päiväkirjamerkintä tallennettu onnistuneesti!"),console.log("API-vastaus:",L),d||I.push({entry_id:L.entry_id,entry_date:m,mood:f,energy_level:k,stress_level:p,sleep_hours:y,notes:v,goals:h}),r(),s.disabled=!1,o.innerHTML=`
        <p><strong>Päivämäärä:</strong> ${new Date(m).toLocaleDateString("fi-FI")}</p>
        <p><strong>Mieliala:</strong> ${f}</p>
        <p><strong>Energia:</strong> ${k}/10</p>
        <p><strong>Stressi:</strong> ${p}/10 (${g})</p>
        <p><strong>Uni:</strong> ${y}h</p>
        ${v?`<p><strong>Muistiinpanot:</strong> ${v}</p>`:""}
        ${h?`<p><strong>Tavoitteet:</strong> ${h}</p>`:""}
      `,l.innerHTML=`
      <h4 class="analysis-title">Mitä tämä tarkoittaa?</h4>
      <div class="analysis-body">
        <p>🧘🏻 <strong>Stressi:</strong> ${B}</p>
        <p>💤 <strong>Uni:</strong> ${$}</p>
        <p>🤔 <strong>Mieliala:</strong> ${x}</p>
        <p class="encouragement">Jatka eteenpäin! Pienet askeleet vievät suuriin muutoksiin 🫶🏻</p>
      </div>
    `,e.style.display="block",await M(),r(),t.reset(),document.getElementById("entry_id").value=""}),i.addEventListener("click",function(){e.style.display="none"})});
