import"./modulepreload-polyfill-B5Qt9EMX.js";import"./home-B7Iwr7-j.js";import{f as C}from"./fetch-CfNAfVVD.js";const E=document.getElementById("entry_date");document.getElementById("month-year");const L=document.getElementById("calendar-dates"),K=document.getElementById("prev-month"),q=document.getElementById("next-month"),w=document.getElementById("history-popup"),T=document.getElementById("history-popup-content"),z=document.getElementById("popup-date"),U=document.getElementById("close-history-popup"),H=document.getElementById("jump-to-today"),D=document.getElementById("selected-month"),S=document.getElementById("selected-year");let I=[],u=new Date;M();const Y=["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"];function V(){const t=prompt("Valitse kuukausi (1–12):"),e=parseInt(t);!isNaN(e)&&e>=1&&e<=12&&(u.setMonth(e-1),d())}function O(){const t=prompt("Valitse vuosi (esim. 2025):"),e=parseInt(t);isNaN(e)||(u.setFullYear(e),d())}D&&D.addEventListener("click",V);S&&S.addEventListener("click",O);function b(t){const e=new Date(t),o=e.getFullYear(),c=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${o}-${c}-${r}`}async function M(){const t=localStorage.getItem("token");if(!t){alert("Kirjaudu sisään."),window.location.href="login.html";return}const o=await C("https://stress-help.northeurope.cloudapp.azure.com/api/entries",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(o.error){console.error("Virhe haettaessa tietoja!",o.error);return}I=Array.isArray(o)?o:Array.isArray(o.entries)?o.entries:Array.isArray(o.data)?o.data:[],I.sort((c,r)=>new Date(r.entry_date)-new Date(c.entry_date)),d()}function d(){const t=u.getFullYear(),e=u.getMonth(),o=new Date(t,e,1).getDay(),c=new Date(t,e+1,0).getDate(),r=new Date(t,e,0).getDate(),n=new Date,s=(o+6)%7;L.innerHTML="",D&&(D.textContent=Y[e]),S&&(S.textContent=t);for(let a=s;a>0;a--)L.innerHTML+=`<div class="calendar-date" style="opacity: 0.4">${r-a+1}</div>`;for(let a=1;a<=c;a++){let k=function(p){const v=I.filter(y=>b(y.entry_date)===p);if(v.length===0)return"";const h=Math.max(...v.map(y=>y.stress_level??0));return h>=8?'<div class="dot red"></div>':h>=4?'<div class="dot yellow"></div>':'<div class="dot green"></div>'};const g=`${t}-${String(e+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`,l=a===n.getDate()&&e===n.getMonth()&&t===n.getFullYear(),f=E&&E.value===g;let m=l?'<div id="live-time" style="font-size: 0.6rem; font-weight: bold; margin-top: 4px;"></div>':"";L.innerHTML+=`
      <div class="calendar-date ${l?"today":""} ${f?"selected":""}" data-date="${g}">
        <div class="date-number">${a}</div>
        ${k(g)}
        ${m}
      </div>`}const i=document.querySelector(".calendar-date.today");i&&i.scrollIntoView({behavior:"smooth",block:"center"})}L.addEventListener("click",t=>{const e=t.target.closest(".calendar-date");if(!e)return;const o=e.getAttribute("data-date");E&&(E.value=o),document.querySelectorAll(".calendar-date").forEach(n=>n.classList.remove("selected")),e.classList.add("selected");const c=new Date(o).toLocaleDateString("fi-FI");z.textContent=c,T.innerHTML="";const r=I.filter(n=>b(n.entry_date)===o);r.length===0?T.innerHTML="<p>Ei merkintöjä tälle päivälle.</p>":r.forEach(n=>{const s=document.createElement("div");s.className="popup-entry-card";let i="Ei tietoa";typeof n.stress_level=="number"&&(n.stress_level>=8?i="Korkea stressi":n.stress_level>=4?i="Kohtalainen stressi":i="Normaali stressi"),s.innerHTML=`
        <div class="popup-entry">
          <h4>Mieliala: ${n.mood||"Ei ilmoitettu"}</h4>
          <p><strong>Energiataso:</strong> ${n.energy_level??"Ei tietoa"}</p>
          <p><strong>Stressitaso:</strong> ${i}</p>
          <p><strong>Uni (tunnit):</strong> ${n.sleep_hours??"Ei tietoa"}</p>
          <p><strong>Muistiinpanot:</strong> ${n.notes||"Ei muistiinpanoja."}</p>
          <p><strong>Tavoitteet:</strong> ${n.goals||"Ei tavoitteita."}</p>

          <div class="popup-buttons">
            <button class="modify-entry" data-id="${n.entry_id}">✏️ Muokkaa</button>
            <button class="delete-entry" data-id="${n.entry_id}">🗑️ Poista</button>
          </div>
        </div>`,s.querySelector(".delete-entry").addEventListener("click",async a=>{const g=a.currentTarget.dataset.id,l=localStorage.getItem("token");if(!l)return alert("Kirjaudu sisään.");if(!confirm("Poistetaanko merkintä?"))return;(await fetch(`https://stress-help.northeurope.cloudapp.azure.com/api/entries/${g}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})).ok?(alert("Poistettu."),await M(),d(),e.dispatchEvent(new Event("click"))):alert("Poistaminen epäonnistui.")}),s.querySelector(".modify-entry").addEventListener("click",async()=>{document.getElementById("entry_id").value=n.entry_id,document.getElementById("entry_date").value=b(n.entry_date),document.getElementById("mood").value=n.mood||"",document.getElementById("energy_level").value=n.energy_level??"",document.getElementById("stress_level").value=n.stress_level??"",document.getElementById("sleep_hours").value=n.sleep_hours??"",document.getElementById("notes").value=n.notes||"",document.getElementById("goals").value=n.goals||"",w.style.display="none",window.scrollTo({top:0,behavior:"smooth"}),await M(),d()}),T.appendChild(s)}),w.style.display="block"});U.addEventListener("click",()=>{w.style.display="none"});K.addEventListener("click",()=>{u.setMonth(u.getMonth()-1),d()});q.addEventListener("click",()=>{u.setMonth(u.getMonth()+1),d()});function A(){const t=document.getElementById("calendar-clock");if(t){const e=new Date;t.textContent=e.toLocaleTimeString("fi-FI",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}}function N(){const t=document.getElementById("today-clock"),e=document.getElementById("today-date");if(t&&e){const o=new Date;t.textContent=o.toLocaleTimeString("fi-FI",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),e.textContent=o.toLocaleDateString("fi-FI",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}}setInterval(()=>{A(),N()},1e3);A();N();H&&H.addEventListener("click",()=>{u=new Date,E&&(E.value=""),document.querySelectorAll(".calendar-date.selected").forEach(t=>{t.classList.remove("selected")}),d()});document.addEventListener("DOMContentLoaded",function(){document.getElementById("entry_date");const t=document.querySelector(".diaryForm"),e=document.getElementById("popup"),o=document.querySelector(".diary-popup");document.getElementById("category");const c=document.getElementById("analysis"),r=document.getElementById("close-popup");t.addEventListener("submit",async function(n){n.preventDefault();const s=t.querySelector('input[type="submit"]');s.disabled=!0;const i=document.getElementById("entry_id").value,a=i?"PUT":"POST",g=i?`https://stress-help.northeurope.cloudapp.azure.com/api/entries/${i}`:"https://stress-help.northeurope.cloudapp.azure.com/api/entries",l=document.getElementById("entry_date").value,f=document.getElementById("mood").value.toLowerCase(),k=document.getElementById("energy_level").value,m=parseInt(document.getElementById("stress_level").value),p=parseInt(document.getElementById("sleep_hours").value),v=document.getElementById("notes").value,h=document.getElementById("goals").value;if(!l||isNaN(m)||isNaN(p)){alert("Täytä kaikki vaaditut kentät."),s.disabled=!1;return}let y="",B="";if(m>=8){y="Korkea stressi";const P=["Kokeile syvähengitystä.","Kuuntele rauhoittavaa musiikkia.","Mene ulos raikkaaseen ilmaan.","Kirjoita ajatuksiasi ylös."];B=`Stressitasosi on korkea. ${P[Math.floor(Math.random()*P.length)]}`}else m>=4?(y="Kohtalainen stressi",B="Stressitasosi on kohtalainen. Pidä taukoja ja huolehdi itsestäsi."):(y="Normaali stressi",B="Hallitset stressiä hyvin!");let _="";p<4?_="Liian vähän unta! Paranna tapojasi.":p<7?_="Unesi voisi olla parempi. Pyri nukkumaan vähintään 7 tuntia.":_="Hienoa! Unesi kesto on terveellistä.";let x="Kiitos, että jaoit mielialasi!";const F={entry_date:l,mood:f,energy_level:k,stress_level:m,sleep_hours:p,notes:v,goals:h},j=localStorage.getItem("token");if(!j){alert("Sinun täytyy olla kirjautuneena."),s.disabled=!1;return}const $=await C(g,{method:a,headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"},body:JSON.stringify(F)});if($.error){console.error("Virhe päiväkirjamerkinnän tallentamisessa!",$.error),alert("Päiväkirjamerkintää ei voitu tallentaa."),s.disabled=!1;return}console.log("Päiväkirjamerkintä tallennettu onnistuneesti!"),console.log("API-vastaus:",$),i||I.push({entry_id:$.entry_id,entry_date:l,mood:f,energy_level:k,stress_level:m,sleep_hours:p,notes:v,goals:h}),d(),s.disabled=!1,o.innerHTML=`
        <p><strong>Päivämäärä:</strong> ${new Date(l).toLocaleDateString("fi-FI")}</p>
        <p><strong>Mieliala:</strong> ${f}</p>
        <p><strong>Energia:</strong> ${k}/10</p>
        <p><strong>Stressi:</strong> ${m}/10 (${y})</p>
        <p><strong>Uni:</strong> ${p}h</p>
        ${v?`<p><strong>Muistiinpanot:</strong> ${v}</p>`:""}
        ${h?`<p><strong>Tavoitteet:</strong> ${h}</p>`:""}
      `,c.innerHTML=`
      <h4 class="analysis-title">Mitä tämä tarkoittaa?</h4>
      <div class="analysis-body">
        <p>🧘🏻 <strong>Stressi:</strong> ${B}</p>
        <p>💤 <strong>Uni:</strong> ${_}</p>
        <p>🤔 <strong>Mieliala:</strong> ${x}</p>
        <p class="encouragement">Jatka eteenpäin! Pienet askeleet vievät suuriin muutoksiin 🫶🏻</p>
      </div>
    `,e.style.display="block",await M(),d(),t.reset(),document.getElementById("entry_id").value=""}),r.addEventListener("click",function(){e.style.display="none"})});
