import"./modulepreload-polyfill-B5Qt9EMX.js";import"./home-B7Iwr7-j.js";import"./user-info-WQLXiwV3.js";import{f as g}from"./fetch-CfNAfVVD.js";document.addEventListener("DOMContentLoaded",async()=>{const e=localStorage.getItem("token");if(!e){console.log("Ei l√∂ytynyt voimassa olevaa tokenia.");return}const r="https://stress-help.northeurope.cloudapp.azure.com/api/entries",s={method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}},n=await g(r,s);if(n.error){console.log(n.error);return}if(!n.length){console.log("Ei p√§iv√§kirjamerkint√∂j√§ l√∂ytynyt.");return}const l=n.sort((t,m)=>new Date(m.entry_date)-new Date(t.entry_date))[0];document.getElementById("latest-date").textContent=x(l.entry_date),document.getElementById("latest-notes").textContent=l.notes||"-";let o="-";typeof l.stress_level=="number"&&(l.stress_level>=8?o="Korkea stressi":l.stress_level>=4?o="Kohtalainen stressi":o="Normaali stressi"),document.getElementById("latest-stress").textContent=o});function x(e){return new Date(e).toLocaleDateString("fi-FI")}let y=[];const b=async()=>{const e=localStorage.getItem("token");if(!e){window.location.href="login.html";return}const r="https://stress-help.northeurope.cloudapp.azure.com/api/kubios-data/user-data";try{const s=await fetch(r,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!s.ok){console.error("Virhe Kubiosin datan hakemisessa:",s.status),alert("Virhe datan hakemisessa. Yrit√§ uudelleen.");return}const n=await s.json();if(console.log("API:n palauttama data:",n),n&&Array.isArray(n.results)){const l=n.results.filter(o=>o.daily_result!==null).map(o=>{const t=o.result||{};return{date:o.daily_result,timestamp:o.daily_result,readiness:t.readiness!==void 0?parseFloat((t.readiness||0).toFixed(1)):0,stress_index:t.stress_index!==void 0?parseFloat((t.stress_index||0).toFixed(2)):0,rmssd_ms:t.rmssd_ms!==void 0?parseFloat((t.rmssd_ms||0).toFixed(1)):0,mean_hr_bpm:t.mean_hr_bpm!==void 0?parseFloat((t.mean_hr_bpm||0).toFixed(0)):0}});y=l,l.length>0?(k(l[l.length-1]),f("3months")):(console.warn("Ei dataa n√§ytett√§v√§ksi."),alert("Ei Kubios-dataa saatavilla."))}else console.error("Datan rakenteessa on virhe.")}catch(s){console.error("Virhe API-kutsussa:",s),alert("Jokin meni pieleen. Yrit√§ my√∂hemmin.")}};function k(e){const s=(i=>new Date(i).toLocaleDateString("fi-FI",{day:"2-digit",month:"2-digit",year:"numeric"}))(e.date);document.getElementById("readiness-value").textContent=`${e.readiness}%`,document.getElementById("mean-hr-value").textContent=`${e.mean_hr_bpm} bpm`,document.getElementById("rmssd-value").textContent=`${e.rmssd_ms} ms`,document.getElementById("stress-index-value").textContent=`${e.stress_index}`;const n=document.getElementById("readiness-category");e.readiness<25?(n.textContent="üî¥ Eritt√§in matala valmiustaso",n.style.color="#e74c3c"):e.readiness<50?(n.textContent="üü† Matala valmiustaso",n.style.color="#f39c12"):e.readiness<75?(n.textContent="üîµ Normaali valmiustaso",n.style.color="#3498db"):(n.textContent="üü¢ Korkea valmiustaso",n.style.color="#27ae60");const l=document.getElementById("stress-level-text");let o="",t="";e.readiness<50?(o="Stressi taso: Korkea",t=`<p style="color: #ff5555; font-weight: bold;">Suosittelemme vierailemaan 
      <a href="tools.html" target="_blank" style="color: #4faae6;">StressHelpin tukisivulla</a>.</p>`):e.readiness<75?(o="Stressi taso: Keskitaso",t=`<p style="color: #f6b500; font-weight: bold;">Stressitasosi on kohtalainen. 
      <a href="tools.html" target="_blank" style="color: #4faae6;"> Kokeile rentoutumisty√∂kaluja.</a></p>`):(o="Stressi taso: Matala",t='<p style="color: #84ad83; font-weight: bold;">Hienoa! Stressitasosi on matala. Jatka samaan malliin!</p>'),l.textContent=o;const m=document.createElement("div");m.className="stress-recommendation",m.innerHTML=t,l.insertAdjacentElement("afterend",m);const u=document.getElementById("resultsChart").getContext("2d");new Chart(u,{type:"bar",data:{labels:["Valmiusindeksi (%)","Stressi-indeksi","RMSSD","Keskisyke (BPM)"],datasets:[{label:`Mittausp√§iv√§: ${s}`,data:[e.readiness,e.stress_index,e.rmssd_ms,e.mean_hr_bpm],backgroundColor:["#4E79A7","#E15759","#76B7B2","#F28E2B"],borderRadius:12,barThickness:40,categoryPercentage:.6,barPercentage:.8}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,labels:{font:{family:"Poppins",size:20,weight:"bold"},color:"#333"}},tooltip:{backgroundColor:"#f9f9f9",titleColor:"#333",bodyColor:"#333",borderColor:"#ccc",borderWidth:1,padding:10,titleFont:{weight:"bold"},callbacks:{label:function(i){const c=i.dataset.label||"";let p=i.raw;return i.label==="Valmiusindeksi (%)"?`${c}: ${p.toFixed(1)}%`:i.label==="Keskisyke (BPM)"?`${c}: ${p.toFixed(0)} bpm`:i.label==="RMSSD"?`${c}: ${p.toFixed(1)} ms`:i.label==="Stressi-indeksi"?`${c}: ${p.toFixed(2)}`:`${c}: ${p}`}}}},scales:{x:{ticks:{color:"#333",font:{family:"Poppins",size:12}},grid:{display:!1}},y:{beginAtZero:!0,ticks:{precision:0,color:"#333",font:{family:"Poppins",size:12},callback:function(i){return i.toFixed(0)}},grid:{color:"rgba(0,0,0,0.05)"}}}}})}let a,d;function h(){a&&a.dispose()}function w(e){h(),a=am5.Root.new("chartdiv"),a.setThemes([am5themes_Animated.new(a)]),d=a.container.children.push(am5xy.XYChart.new(a,{panX:!0,panY:!1,wheelX:"panX",wheelY:"zoomX"}));const r=d.xAxes.push(am5xy.DateAxis.new(a,{baseInterval:{timeUnit:"day",count:1},renderer:am5xy.AxisRendererX.new(a,{})})),s=d.yAxes.push(am5xy.ValueAxis.new(a,{renderer:am5xy.AxisRendererY.new(a,{}),numberFormat:"#.##"})),n=e.map(t=>({date:new Date(t.timestamp).getTime(),readiness:t.readiness,stress_index:t.stress_index}));function l(t,m,u){const i=d.series.push(am5xy.LineSeries.new(a,{name:u,valueYField:t,valueXField:"date",xAxis:r,yAxis:s,tooltip:am5.Tooltip.new(a,{labelText:t==="readiness"?"{name}: {valueY.formatNumber('#.0')}%":"{name}: {valueY.formatNumber('#.00')}"})}));i.strokes.template.setAll({stroke:am5.color(m),strokeWidth:2}),i.bullets.push(()=>am5.Bullet.new(a,{sprite:am5.Circle.new(a,{radius:5,fill:am5.color(m),stroke:am5.color(16777215),strokeWidth:1})})),i.data.setAll(n)}l("readiness",2664261,"Valmiusindeksi (%)"),l("stress_index",14431557,"Stressi-indeksi"),d.set("cursor",am5xy.XYCursor.new(a,{behavior:"zoomX",xAxis:r})),d.set("scrollbarX",am5.Scrollbar.new(a,{orientation:"horizontal"}));const o=d.children.push(am5.Legend.new(a,{centerX:am5.p50,x:am5.p50,layout:a.horizontalLayout}));d.series.each(t=>{o.data.push(t),t.get("legendDataItem").get("marker").get("background").setAll({fillOpacity:0,strokeOpacity:1,stroke:t.get("stroke"),strokeWidth:2})}),d.appear(1e3,100)}function _(e){h(),a=am5.Root.new("chartdiv"),a.setThemes([am5themes_Animated.new(a)]),d=a.container.children.push(am5xy.XYChart.new(a,{layout:a.verticalLayout,panX:!1,panY:!1,wheelX:"panX",wheelY:"zoomX"}));const r=e.map(t=>({label:new Date(t.date).toLocaleDateString("fi-FI"),rmssd_ms:t.rmssd_ms,mean_hr_bpm:t.mean_hr_bpm,stress_index:t.stress_index,readiness:t.readiness})),s=d.xAxes.push(am5xy.CategoryAxis.new(a,{categoryField:"label",renderer:am5xy.AxisRendererX.new(a,{cellStartLocation:.1,cellEndLocation:.9}),tooltip:am5.Tooltip.new(a,{})}));s.data.setAll(r);const n=d.yAxes.push(am5xy.ValueAxis.new(a,{renderer:am5xy.AxisRendererY.new(a,{strokeOpacity:.1}),numberFormat:"#.##"})),l=d.children.push(am5.Legend.new(a,{centerX:am5.p50,x:am5.p50}));function o(t,m,u){let i;t==="mean_hr_bpm"?i="#,###":t==="rmssd_ms"?i="#.#":i="#.##";const c=d.series.push(am5xy.ColumnSeries.new(a,{name:u,xAxis:s,yAxis:n,valueYField:t,categoryXField:"label"}));c.columns.template.setAll({tooltipText:`{name}, {categoryX}: {valueY.formatNumber('${i}')}`,width:am5.percent(90),tooltipY:0,strokeOpacity:0,fill:am5.color(m)}),c.data.setAll(r),l.data.push(c)}o("readiness",5142951,"Valmiusindeksi (%)"),o("stress_index",14767961,"Stressi-indeksi"),o("rmssd_ms",7780274,"RMSSD"),o("mean_hr_bpm",15896107,"Keskisyke (BPM)"),d.appear(1e3,100)}function v(e){const r=new Date;let s=new Date(r);return e==="week"&&s.setDate(r.getDate()-7),e==="month"&&s.setMonth(r.getMonth()-1),e==="3months"&&s.setMonth(r.getMonth()-3),y.filter(n=>new Date(n.timestamp)>=s)}function f(e){const r=document.getElementById("chartTypeSelect").value,s=v(e);if(s.length===0){console.warn("Ei dataa valitulle aikajaksolle."),h();return}r==="line"?w(s):_(s)}document.getElementById("chartTypeSelect").addEventListener("change",()=>{var r;const e=((r=document.querySelector(".range-btn.active"))==null?void 0:r.dataset.range)||"3months";f(e)});document.querySelectorAll(".range-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".range-btn").forEach(s=>s.classList.remove("active")),e.classList.add("active");const r=e.dataset.range;f(r)})});document.addEventListener("DOMContentLoaded",b);
